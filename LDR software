define LDR 36
#define LED_PIN 2

// Software Low-pass filter variables
int PrevOutput = 0;
int Weight = 4;       // ปรับค่าตามต้องการ (ค่าเริ่มต้น)

// Threshold ปกติ (ไม่ใช้ hysteresis)
int Threshold = 2000;

void setup() {
  Serial.begin(9600);
  pinMode(LED_PIN, OUTPUT);
}

void loop() {
  int NewInput = analogRead(LDR);

  // Software Low-pass filter (EMA)
  int Filtered = (NewInput + (Weight * PrevOutput)) / (Weight + 1);

  PrevOutput = Filtered;

  // LED control (no hysteresis)
  int ledState = (Filtered < Threshold) ? 100 : 0;
  digitalWrite(LED_PIN, (ledState > 0) ? HIGH : LOW);

  // Data for Serial Plotter
  Serial.print("Raw:");        Serial.print(NewInput);
  Serial.print("  Filter:");   Serial.print(Filtered);
  Serial.print("  LED:");      Serial.println(ledState);

  delay(50);
}
